#! clean build test -tKOW 9 -g 0 -p @,test

name: mkn
scm: https://github.com/dekken/maiken
version: master
property:
    DATE: 29-NOV-2019

parent: lib
mode: none
main: mkn.cpp

profile:
- name: headers
  inc: ./inc
  dep: mkn.kul
  if_arg:
    shared: -DKUL_SHARED -DKUL_EXPORT
    win_shared: -DYAML_CPP_DLL

- name: lib
  parent: headers
  src: ./src
  dep: parse.yaml
  arg: -D_MKN_VERSION_=${version}_${DATE}
  if_link:
    nix: -ldl -pthread
    win_cl: -nodefaultlib:libucrt.lib ucrt.lib

- name: static
  parent: lib
  mode: static

- name: shared
  parent: lib
  mode: shared

- name: mod
  parent: headers
  mode: shared
  src: ./src
  with: parse.yaml[shared]

- name: server
  parent: lib
  with: io.cereal mkn.ram[https]
  main: server.cpp
  mode: none

- name: format
  mod: |
    clang.format{init:{style: file, paths: .}}

- name: test
  test: test/cpp.cpp
  env: PYTHONPATH=.
  mod: |
     mkn-mod.exec{test: ./test/test.sh }

